webpackJsonp([1],{FEjZ:function(e,t){},mPFa:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l("woOf"),n=l.n(i),a=l("bOdI"),o=l.n(a),s={props:{options:{type:Array,default:function(){return[{name:"",value:""}]}}},data:function(){return{}},methods:{plus:function(){this.options.push({name:"",value:""})},minus:function(e){this.options.splice(e,1)}},watch:{options:{deep:!0,handler:function(e){this.$emit("optionsChange",e)}}}},r={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-form",e._l(e.options,function(t,i){return l("el-form-item",{key:i},[l("el-row",{staticStyle:{"margin-bottom":"10px"}},[l("el-col",{staticStyle:{"margin-right":"5px"},attrs:{span:6}},[l("el-input",{attrs:{placeholder:"选项名"},model:{value:t.name,callback:function(l){e.$set(t,"name",l)},expression:"option.name"}})],1),e._v(" "),l("el-col",{attrs:{span:4}},[l("el-input",{attrs:{placeholder:"选项值"},model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"option.value"}})],1),e._v(" "),0==i?l("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-plus",circle:""},on:{click:e.plus}}):e._e(),e._v(" "),0!=i?l("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-minus",circle:""},on:{click:function(t){return e.minus(i)}}}):e._e()],1)],1)}),1)},staticRenderFns:[]};var d={components:{"add-options":l("VU/8")(s,r,!1,function(e){l("FEjZ")},"data-v-36b6655a",null).exports},data:function(){return{id:null,loading:!1,activeName:"basic",fields:[],modelForm:{id:null,name:"",channel_template_prefix:"",content_template_prefix:""},fieldTitle:"添加字段",fieldVisible:!1,fieldForm:{id:"",model_id:null,type:"",field:"",label:"",extra:[],is_channel:0,is_custom:1,is_display:1,is_required:0},showOptions:!1,options:[]}},watch:o()({},"fieldForm.type",function(e,t){var l=this;this.options.forEach(function(t){t.type==e&&(t.extra.options?l.showOptions=!0:l.showOptions=!1)})}),computed:{channelFields:function(){return this.fields.filter(function(e){return 1===e.is_channel})},contentFields:function(){return this.fields.filter(function(e){return 0===e.is_channel})}},methods:{handleEdit:function(e){this.fieldVisible=!0,n()(this.fieldForm,e)},handleDelete:function(e){var t=this;this.$confirm("确定删除字段?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var l=t.fieldForm.model_id;t.$http.post("/admin/cms/model/delete/field",{model_id:l,id:e.id}).then(function(e){t.loadModel(l),t.$message({type:"success",message:"删除成功!"})}).catch(function(){})})},beforeLeave:function(e,t){return!0},add:function(e){if(!this.modelForm.id)return this.$message({message:"请先提交基本信息!",type:"warning"}),void(this.activeName="basic");"channel"==e?this.fieldForm.is_channel=1:"content"==e&&(this.fieldForm.is_channel=0),this.fieldVisible=!0,n()(this.fieldForm,{id:"",type:"",field:"",label:"",extra:[{name:"",value:""}],is_custom:1,is_display:1,is_required:0}),this.showOptions=!1},loadFieldTypes:function(){var e=this;this.$http.get("/admin/cms/model/field/types").then(function(t){e.options=t.data})},loadModel:function(e){var t=this;this.$http.get("/admin/cms/model/get",{params:{id:e}}).then(function(e){t.fields=e.data.fields,n()(t.modelForm,e.data),t.fieldForm.model_id=e.data.id})},save:function(){var e=this;this.$http.post("/admin/cms/model/save",this.modelForm).then(function(t){if(t.success){var l="添加成功!";e.modelForm.id&&(l="更新成功!"),e.$message({message:l,type:"success"}),n()(e.modelForm,t.data)}else e.$message({message:"出错了!请联系管理员",type:"warning"})})},doSaveField:function(){var e=this;this.$http.post("/admin/cms/model/save/field",this.fieldForm).then(function(t){if(t.success){e.fieldVisible=!1;var l="添加成功!";e.fieldForm.id&&(l="更新成功!"),e.$message({message:l,type:"success"}),e.loadModel(e.id)}else e.$message({message:"出错了!请联系管理员",type:"warning"})})},handleClick:function(e,t){console.log(e,t)},handleOptionsChange:function(e){this.fieldForm.extra=e}},mounted:function(){var e=this.$route.params.id;this.id=e,e&&this.loadModel(e),this.loadFieldTypes()}},c={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"l-model-add"},[l("div",{staticClass:"top-buttons",staticStyle:{display:"flex","flex-flow":"row nowrap"}},[l("router-link",{attrs:{to:"/cms/setting/model",tag:"div"}},[l("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),l("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),l("div",[e._v(e._s(e.modelForm.id?"编辑":"新增")+"模型")])],1),e._v(" "),l("div",[l("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[l("el-tab-pane",{attrs:{label:"基本信息",name:"basic"}},[l("el-form",{ref:"form",attrs:{model:e.modelForm,"label-width":"120px"}},[l("el-form-item",{attrs:{label:"模型名"}},[l("el-input",{model:{value:e.modelForm.name,callback:function(t){e.$set(e.modelForm,"name",t)},expression:"modelForm.name"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"栏目模板前缀"}},[l("el-input",{model:{value:e.modelForm.channel_template_prefix,callback:function(t){e.$set(e.modelForm,"channel_template_prefix",t)},expression:"modelForm.channel_template_prefix"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"内容模板前缀"}},[l("el-input",{model:{value:e.modelForm.content_template_prefix,callback:function(t){e.$set(e.modelForm,"content_template_prefix",t)},expression:"modelForm.content_template_prefix"}})],1),e._v(" "),l("el-form-item",[l("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1)],1),e._v(" "),l("el-tab-pane",{attrs:{label:"栏目字段",name:"channel"}},[l("div",{staticStyle:{"text-align":"left","margin-bottom":"20px"}},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add("channel")}}},[e._v("添加")])],1),e._v(" "),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.channelFields}},[l("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),l("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),l("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),l("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),l("el-tab-pane",{attrs:{label:"内容字段",name:"content"}},[l("div",{staticStyle:{"text-align":"left","margin-bottom":"20px"}},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add("content")}}},[e._v("添加")])],1),e._v(" "),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.contentFields}},[l("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),l("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),l("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),l("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),e._v(" "),l("el-dialog",{attrs:{title:e.fieldTitle,visible:e.fieldVisible},on:{"update:visible":function(t){e.fieldVisible=t}}},[l("el-form",{attrs:{model:e.fieldForm,"label-width":"100px"}},[l("el-form-item",{attrs:{label:"标签"}},[l("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.label,callback:function(t){e.$set(e.fieldForm,"label",t)},expression:"fieldForm.label"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"字段"}},[l("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.field,callback:function(t){e.$set(e.fieldForm,"field",t)},expression:"fieldForm.field"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"类型"}},[l("el-select",{attrs:{placeholder:"请选择"},model:{value:e.fieldForm.type,callback:function(t){e.$set(e.fieldForm,"type",t)},expression:"fieldForm.type"}},e._l(e.options,function(e){return l("el-option",{key:e.value,attrs:{label:e.name,value:e.type}})}),1)],1),e._v(" "),e.showOptions?l("el-form-item",{attrs:{label:"选项"}},[l("add-options",{attrs:{options:e.fieldForm.extra},on:{optionsChange:e.handleOptionsChange}})],1):e._e()],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){e.fieldVisible=!1}}},[e._v("取消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:e.doSaveField}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]},m=l("VU/8")(d,c,!1,null,null,null);t.default=m.exports}});
//# sourceMappingURL=1.53897895b96ef8dd9be3.js.map