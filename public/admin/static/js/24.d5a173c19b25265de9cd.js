webpackJsonp([24],{a4gq:function(e,t){},js6L:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("gyMJ"),a=r("NYxO"),s=r("5reh");function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,s){try{var o=t[a](s),i=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}var i={data:function(){return{emptyText:"loading...",role_id:null,defaultCheckedKeys:[],total:0,tableData:[],customProps:{children:"children",label:"show_name"},treeData:[],currentRole:null,current:null,dialogFormVisible:!1,title:"添加子权限",form:{id:"",parent_id:"",name:"",show_name:""}}},computed:(Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e})({},Object(a.b)(["user"])),watch:{role_id:function(e){var t=this;return o(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.loadRolePermissions(e);case 2:return r.next=4,t.getRole(e);case 4:case"end":return r.stop()}},r,t)}))()}},methods:{saveRolePermissions:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r,a,o,i,c,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$refs["role-permission-tree"].getCheckedNodes(),a=r.filter(function(e){return 0==e.children.length}).map(function(e){return e.id?e.id:""}),o=e.currentRole.id,t.next=5,n.a.givePermissionsTo({permissions:a,role_id:o});case 5:i=t.sent,c=i.data.logout,u="设置成功!",c&&(e.$store.dispatch(s.default.logout),u+=" 请重新登录"),e.$message({type:"success",message:u});case 10:case"end":return t.stop()}},t,e)}))()},loadPermissionsTree:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.getPermissionsTree();case 2:r=t.sent,e.treeData=[r.data[Object.keys(r.data)[0]]];case 4:case"end":return t.stop()}},t,e)}))()},getRole:function(e){var t=this;return o(regeneratorRuntime.mark(function r(){var a,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.a.getRole({role_id:e});case 2:a=r.sent,s=a.data,t.currentRole=s;case 5:case"end":return r.stop()}},r,t)}))()},loadRolePermissions:function(e){var t=this;return o(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.a.getRolePermissions({role_id:e});case 2:a=r.sent,t.defaultCheckedKeys=a.data;case 4:case"end":return r.stop()}},r,t)}))()},loadUserPermissions:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.getUserPermissions();case 2:r=e.sent,localStorage.setItem("privileges",JSON.stringify(r));case 4:case"end":return e.stop()}},t,e)}))()}},mounted:function(){var e=this;return o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.role_id=parseInt(e.$route.query.role_id||0),t.next=3,e.loadPermissionsTree();case 3:case"end":return t.stop()}},t,e)}))()}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"l-block"},[r("div",{staticClass:"l-block-header"},[r("div",{staticStyle:{display:"inline-block"}},[r("router-link",{attrs:{to:"/privileges/roles",tag:"span"}},[r("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("span",[e.currentRole?r("span",[e._v("「"+e._s(e.currentRole.name)+"」")]):e._e(),e._v("权限")])],1),e._v(" "),r("div",[r("el-button",{attrs:{type:"primary"},on:{click:e.saveRolePermissions}},[e._v("保存")])],1)]),e._v(" "),r("div",{staticClass:"l-block-body"},[r("div",[r("div",{staticStyle:{width:"60%"}},[r("el-tree",{ref:"role-permission-tree",attrs:{"empty-text":e.emptyText,data:e.treeData,"default-expand-all":"","show-checkbox":"","node-key":"id",props:e.customProps,"default-checked-keys":e.defaultCheckedKeys,"expand-on-click-node":!1,"check-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return t.data,r("span",{staticClass:"custom-tree-node"},[r("span",{style:{letterSpacing:n.isLeaf?"0.2px":.2*Math.abs(n.level-10)+"px",fontSize:Math.max(22-2*n.level,13)+"px"}},[e._v(e._s(n.label))])])}}])})],1),e._v(" "),r("div",{staticClass:"l-delimiter"})])])])])},staticRenderFns:[]};var u=r("VU/8")(i,c,!1,function(e){r("a4gq")},"data-v-2867a08c",null);t.default=u.exports}});
//# sourceMappingURL=24.d5a173c19b25265de9cd.js.map