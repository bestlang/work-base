webpackJsonp([2],{"7Cn+":function(e,t){},FEjZ:function(e,t){},HOqM:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l("woOf"),a=l.n(n),o=l("Xxa5"),i=l.n(o),r=l("exGp"),s=l.n(r),c=l("Dd8w"),d=l.n(c),u=l("bOdI"),p=l.n(u),f={props:{options:{type:Array,default:function(){return[{name:"",value:""}]}}},data:function(){return{}},methods:{plus:function(){this.options.push({name:"",value:""})},minus:function(e){this.options.splice(e,1)}},watch:{options:{deep:!0,handler:function(e){this.$emit("optionsChange",e)}}}},m={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-form",e._l(e.options,function(t,n){return l("el-form-item",{key:n},[l("el-row",{staticStyle:{"margin-bottom":"10px"}},[l("el-col",{staticStyle:{"margin-right":"5px"},attrs:{span:6}},[l("el-input",{attrs:{placeholder:"选项名"},model:{value:t.name,callback:function(l){e.$set(t,"name",l)},expression:"option.name"}})],1),e._v(" "),l("el-col",{attrs:{span:4}},[l("el-input",{attrs:{placeholder:"选项值"},model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"option.value"}})],1),e._v(" "),0==n?l("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-plus",circle:""},on:{click:e.plus}}):e._e(),e._v(" "),0!=n?l("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-minus",circle:""},on:{click:function(t){return e.minus(n)}}}):e._e()],1)],1)}),1)},staticRenderFns:[]};var v=l("VU/8")(f,m,!1,function(e){l("FEjZ")},"data-v-36b6655a",null).exports,b=l("gyMJ"),_=l("NYxO"),h={components:{"add-options":v},data:function(){return{model_id:null,type:"",loading:!1,activeName:"basic",fields:[],fieldTitle:"添加字段",fieldVisible:!1,fieldForm:{id:"",model_id:null,type:"",field:"",label:"",extra:[],is_channel:0,is_custom:1,is_display:1,is_required:0},showOptions:!1,options:[]}},watch:p()({},"fieldForm.type",function(e,t){var l=this;this.options.forEach(function(t){t.type==e&&(t.extra.options?l.showOptions=!0:l.showOptions=!1)})}),computed:d()({},Object(_.b)(["currentModel"]),{channelFields:function(){return this.fields.filter(function(e){return 1===e.is_channel})},contentFields:function(){return this.fields.filter(function(e){return 0===e.is_channel})}}),methods:{saveOrderFactor:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return s()(i.a.mark(function l(){var n,a;return i.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(n=[],a=[],[],t?e.channelFields:e.contentFields,e.fields.forEach(function(e){n.push(e.id),a.push(e.order_factor)}),n.length){l.next=8;break}return e.$message({type:"warning",message:"无内容!"}),l.abrupt("return",!1);case 8:return l.next=10,b.a.saveModelFieldOrder({ids:n,orders:a});case 10:l.sent,e.$message({type:"success",message:"保存成功!"});case 12:case"end":return l.stop()}},l,e)}))()},handleEdit:function(e){this.fieldVisible=!0,a()(this.fieldForm,e)},handleDelete:function(e){var t=this;this.$confirm("确定删除字段?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(s()(i.a.mark(function l(){var n;return i.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=t.fieldForm.model_id,l.next=3,b.a.deleteModelField({model_id:n,id:e.id});case 3:return l.sent,l.next=6,t.loadModel(n);case 6:t.$message({type:"success",message:"删除成功!"});case 7:case"end":return l.stop()}},l,t)})))},add:function(e){"channel"==e?this.fieldForm.is_channel=1:"content"==e&&(this.fieldForm.is_channel=0),this.fieldVisible=!0,a()(this.fieldForm,{id:"",type:"",field:"",label:"",extra:[{name:"",value:""}],is_custom:1,is_display:1,is_required:0}),this.showOptions=!1},loadFieldTypes:function(){var e=this;return s()(i.a.mark(function t(){var l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.getModelFieldTypes();case 2:l=t.sent,e.options=l.data;case 4:case"end":return t.stop()}},t,e)}))()},loadModel:function(e){var t=this;return s()(i.a.mark(function l(){var n;return i.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,b.a.getModel({id:e});case 2:n=l.sent,t.$store.dispatch(t.$types.CMS_CURRENT_MODEL,n.data),t.fields=n.data.fields,console.log("this.fields:",t.fields),t.fieldForm.model_id=n.data.id;case 7:case"end":return l.stop()}},l,t)}))()},doSaveField:function(){var e=this;return s()(i.a.mark(function t(){var l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.modelSaveField(e.fieldForm);case 2:if(!t.sent.success){t.next=12;break}return e.fieldVisible=!1,l="添加成功!",e.fieldForm.id&&(l="更新成功!"),e.$message({message:l,type:"success"}),t.next=10,e.loadModel(e.model_id);case 10:t.next=13;break;case 12:e.$message({message:"出错了!请联系管理员",type:"warning"});case 13:case"end":return t.stop()}},t,e)}))()},handleClick:function(e,t){console.log(e,t)},handleOptionsChange:function(e){this.fieldForm.extra=e}},mounted:function(){var e=this;return s()(i.a.mark(function t(){var l,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l=parseInt(e.$route.query.model_id||0),e.model_id=l,!e.model_id){t.next=5;break}return t.next=5,e.loadModel(e.model_id);case 5:return n=e.$route.query.type.toString(),e.type=n,t.next=9,e.loadFieldTypes();case 9:case"end":return t.stop()}},t,e)}))()}},y={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"l-block"},[l("div",{staticClass:"l-block-header"},[l("div",[l("router-link",{attrs:{to:"/cms/setting/model",tag:"span"}},[l("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),l("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),e.currentModel?l("span",[l("span",{staticStyle:{"font-weight":"700"}},[e._v("“"+e._s(e.currentModel.name)+"”")]),e._v("栏目字段管理")]):e._e()],1)]),e._v(" "),l("div",{staticClass:"l-block-body"},["channel"==e.type?l("div",{staticClass:"l-block"},[l("div",{staticClass:"l-block-header"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add(e.type)}}},[e._v("添加")])],1),e._v(" "),l("div",{staticClass:"l-block-body"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.channelFields}},[l("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),l("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),l("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),l("el-table-column",{attrs:{label:"排序值(升序)"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-input",{staticClass:"l-w-60",model:{value:t.row.order_factor,callback:function(l){e.$set(t.row,"order_factor",l)},expression:"scope.row.order_factor"}})]}}],null,!1,1453190568)}),e._v(" "),l("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,103943926)})],1)],1),e._v(" "),l("div",{staticClass:"l-block-bottom"},[l("el-button",{on:{click:e.saveOrderFactor}},[e._v("保存排序")])],1)]):e._e(),e._v(" "),"content"==e.type?l("div",{staticClass:"l-block"},[l("div",{staticClass:"l-block-header"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add(e.type)}}},[e._v("添加")])],1),e._v(" "),l("div",{staticClass:"l-block-body"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.contentFields}},[l("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),l("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),l("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),l("el-table-column",{attrs:{label:"排序值(升序)"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-input",{staticClass:"l-w-60",model:{value:t.row.order_factor,callback:function(l){e.$set(t.row,"order_factor",l)},expression:"scope.row.order_factor"}})]}}],null,!1,1453190568)}),e._v(" "),l("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,103943926)})],1)],1),e._v(" "),l("div",{staticClass:"l-block-bottom"},[l("el-button",{on:{click:e.saveOrderFactor}},[e._v("保存排序")])],1)]):e._e()]),e._v(" "),l("el-dialog",{attrs:{title:e.fieldTitle,visible:e.fieldVisible},on:{"update:visible":function(t){e.fieldVisible=t}}},[l("el-form",{attrs:{model:e.fieldForm,"label-width":"100px"}},[l("el-form-item",{attrs:{label:"标签"}},[l("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.label,callback:function(t){e.$set(e.fieldForm,"label",t)},expression:"fieldForm.label"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"字段"}},[l("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.field,callback:function(t){e.$set(e.fieldForm,"field",t)},expression:"fieldForm.field"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"类型"}},[l("el-select",{attrs:{placeholder:"请选择"},model:{value:e.fieldForm.type,callback:function(t){e.$set(e.fieldForm,"type",t)},expression:"fieldForm.type"}},e._l(e.options,function(e){return l("el-option",{key:e.value,attrs:{label:e.name,value:e.type}})}),1)],1),e._v(" "),e.showOptions?l("el-form-item",{attrs:{label:"选项"}},[l("add-options",{attrs:{options:e.fieldForm.extra},on:{optionsChange:e.handleOptionsChange}})],1):e._e()],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){e.fieldVisible=!1}}},[e._v("取消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:e.doSaveField}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var k=l("VU/8")(h,y,!1,function(e){l("7Cn+")},"data-v-6a622c96",null);t.default=k.exports}});
//# sourceMappingURL=2.11574fe6d8c38befa484.js.map