webpackJsonp([3],{akup:function(e,t){},lEUK:function(e,t){},wvRB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),r=a.n(n),i=a("exGp"),o=a.n(i),s=a("Dd8w"),l=a.n(s),c=a("w+Hh"),d=a("Pgpu"),u=a.n(d),f=a("trTH"),m=a("FO7G"),p=a("M+9c"),h=a("jk0Z"),v={name:"tag",props:{propData:{type:Array,required:!1,default:function(){return[{id:0,name:""}]}}},data:function(){return{rowData:[{id:0,name:""}]}},watch:{rowData:{deep:!0,handler:function(e){this.$emit("tagChange",e)}}},methods:{addRow:function(e){for(var t in this.rowData)this.rowData[t].id;var a={id:this.rowData.length,name:""};this.rowData.push(a)},deleteRow:function(e){for(var t in this.rowData)if(this.rowData[t].id==e.id){this.$delete(this.rowData,t);break}}},created:function(){if(this.propData.length>0){for(var e in this.propData)this.propData[e].id=parseInt(e);this.rowData=this.propData}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-row-tag"},e._l(e.rowData,function(t,n){return a("el-row",{key:n,staticClass:"row-item",attrs:{gutter:0}},[a("el-col",{attrs:{span:7}},[a("el-input",{staticClass:"row-ipt",attrs:{placeholder:"请输入标签"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"row.name"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-top":"5px"},attrs:{span:3}},[a("i",n+1==1?{staticClass:"add-icon el-icon-circle-plus",on:{click:function(a){return e.addRow(t)}}}:{staticClass:"add-icon el-icon-remove",on:{click:function(a){return e.deleteRow(t)}}})])],1)}),1)},staticRenderFns:[]};var b=a("VU/8")(v,_,!1,function(e){a("akup")},"data-v-60bc020c",null).exports,C=a("NYxO"),k=a("gyMJ"),w={data:function(){return{checkList:[],showSwitch:!1,contents:[],formTitle:"添加内容",form:{positions:[]},ueditorConfig:f.a,contentPositions:[],channel_id:0}},components:{"channel-tree":c.a,VueUeditorWrap:u.a,imageUpload:m.a,multipleImageUpload:p.a,attachment:h.a,tag:b},computed:l()({},Object(C.b)(["parentChannel","currentChannel","currentModel"])),watch:{channel_id:function(e){var t=this;return o()(r.a.mark(function a(){var n,i;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=8;break}return a.next=3,k.a.getCmsChannelWhole({id:e});case 3:return n=a.sent,i=n.data,t.$store.dispatch(t.$types.CMS_CURRENT_CHANNEL,i),a.next=8,t.loadModel(i.model_id);case 8:case"end":return a.stop()}},a,t)}))()}},methods:{goback:function(){this.$router.push("/cms/content?channel_id="+this.channel_id)},saveContent:function(){var e=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.form.channel_id||e.form.model_id||(e.$set(e.form,"model_id",e.currentModel.id),e.$set(e.form,"channel_id",e.currentChannel.id)),t.next=3,k.a.saveContent(e.form);case 3:t.sent.success&&(e.$message({type:"success",message:"添加成功!"}),e.goback());case 5:case"end":return t.stop()}},t,e)}))()},handleNodeClick:function(e){var t=this;return o()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=e[0],t.channel_id=n.id,t.$store.dispatch(t.$types.CMS_CURRENT_CHANNEL,n),t.$store.dispatch(t.$types.CMS_PARENT_CHANNEL,n),a.next=6,t.loadModel(n.model.id);case 6:return a.next=8,t.loadContentPositions();case 8:case"end":return a.stop()}},a,t)}))()},loadModel:function(e){var t=this;return o()(r.a.mark(function a(){var n,i,o,s;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,k.a.getModel({id:e});case 2:for(o in n=a.sent,(i=n.data).fields=i.fields.filter(function(e){return!e.is_channel}),t.$store.dispatch(t.$types.CMS_CURRENT_MODEL,i),t.currentModel.fields)s=t.currentModel.fields[o],t.$set(t.form,s.field,""),"checkbox"!=s.type&&"multiple-image"!=s.type||t.$set(t.form,s.field,[]);t.$set(t.form,"positions",[]);case 8:case"end":return a.stop()}},a,t)}))()},loadContentPositions:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return o()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t||e.currentChannel&&e.currentChannel.id&&(t=e.currentChannel.id),t){a.next=3;break}return a.abrupt("return");case 3:return a.next=5,k.a.getContentPositions({channel_id:t});case 5:n=a.sent,e.contentPositions=n.data;case 7:case"end":return a.stop()}},a,e)}))()}},mounted:function(){var e=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.channel_id=parseInt(e.$route.query.channel_id||0),t.next=3,e.loadContentPositions(e.channel_id);case 3:e.$store.dispatch("collapse");case 4:case"end":return t.stop()}},t,e)}))()}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-content-list"},[a("div",{directives:[{name:"title",rawName:"v-title",value:"内容管理",expression:"'内容管理'"}]}),e._v(" "),a("channel-tree",{attrs:{title:"栏目选择",selectedKey:e.channel_id},on:{nodeClick:e.handleNodeClick}}),e._v(" "),a("div",{staticClass:"l-tree-content"},[e.currentModel?a("div",{staticClass:"l-block"},[a("div",{staticClass:"l-block-header"},[a("div",[a("span",{staticClass:"l-go-back",on:{click:e.goback}},[a("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("span",[e._v("在"),a("span",{staticStyle:{"font-weight":"700"}},[e._v("“"+e._s(e.currentChannel.name)+"”")]),e._v("下"+e._s(e.formTitle))])],1)]),e._v(" "),a("div",{staticClass:"l-block-body"},[a("el-form",{attrs:{"label-width":"100px"}},[e._l(e.currentModel.fields,function(t,n){return["text"==t.type?a("el-form-item",{attrs:{label:t.label}},[a("el-input",{key:n,attrs:{name:t.field},model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"checkbox"==t.type&&Array.isArray(e.form[t.field])?a("el-form-item",{attrs:{label:t.label}},[a("el-checkbox-group",{model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}},e._l(t.extra,function(t){return a("el-checkbox",{attrs:{label:t.value}},[e._v(e._s(t.name))])}),1)],1):e._e(),e._v(" "),"image"==t.type?a("el-form-item",{attrs:{label:t.label}},[a("image-upload",{model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"multiple-image"==t.type?a("el-form-item",{attrs:{label:t.label}},[a("multiple-image-upload",{model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"attachment"==t.type?a("el-form-item",{staticClass:"l-mb-22",attrs:{label:t.label}},[a("div",[a("attachment",{model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1)]):e._e(),e._v(" "),"textarea"==t.type?a("el-form-item",{attrs:{label:t.label}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"content"==t.type?a("el-form-item",{staticClass:"l-mb-22",attrs:{label:t.label}},[a("div",[a("vue-ueditor-wrap",{attrs:{config:e.ueditorConfig},model:{value:e.form[t.field],callback:function(a){e.$set(e.form,t.field,a)},expression:"form[item.field]"}})],1)]):e._e()]}),e._v(" "),a("el-form-item",{attrs:{label:"标签"}},[a("tag")],1),e._v(" "),e.contentPositions&&e.contentPositions.length?a("el-form-item",{attrs:{label:"编辑推荐位"}},[a("el-checkbox-group",{model:{value:e.form.positions,callback:function(t){e.$set(e.form,"positions",t)},expression:"form['positions']"}},e._l(e.contentPositions,function(t){return a("el-checkbox",{attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveContent}},[e._v("提交")])],1)],2)],1)]):e._e()])],1)},staticRenderFns:[]};var g=a("VU/8")(w,x,!1,function(e){a("lEUK")},"data-v-b6acd524",null);t.default=g.exports}});
//# sourceMappingURL=3.fdf25282b5bfaeebc69d.js.map