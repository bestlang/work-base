webpackJsonp([2],{"/ziT":function(e,t){},"2shI":function(e,t){},HOqM:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l={props:{options:{type:Array,default:function(){return[{name:"",value:""}]}}},data:function(){return{}},methods:{plus:function(){this.options.push({name:"",value:""})},minus:function(e){this.options.splice(e,1)}},watch:{options:{deep:!0,handler:function(e){this.$emit("optionsChange",e)}}}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",e._l(e.options,function(t,l){return n("el-form-item",{key:l},[n("el-row",{staticStyle:{"margin-bottom":"10px"}},[n("el-col",{staticStyle:{"margin-right":"5px"},attrs:{span:6}},[n("el-input",{attrs:{placeholder:"选项名"},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"option.name"}})],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-input",{attrs:{placeholder:"选项值"},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}})],1),e._v(" "),0==l?n("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-plus",circle:""},on:{click:e.plus}}):e._e(),e._v(" "),0!=l?n("el-button",{staticClass:"l-plus-minus",attrs:{type:"primary",size:"small",icon:"el-icon-minus",circle:""},on:{click:function(t){return e.minus(l)}}}):e._e()],1)],1)}),1)},staticRenderFns:[]};var o=n("VU/8")(l,r,!1,function(e){n("2shI")},"data-v-6847c6de",null).exports,a=n("gyMJ"),i=n("NYxO"),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e};function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function l(r,o){try{var a=t[r](o),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){l("next",e)},function(e){l("throw",e)});e(i)}("next")})}}var u,d,f,p={components:{"add-options":o},data:function(){return{model_id:null,type:"",loading:!1,activeName:"basic",fields:[],fieldTitle:"添加字段",fieldVisible:!1,fieldForm:{id:"",model_id:null,type:"",field:"",label:"",extra:[],is_channel:0,is_custom:1,is_display:1,is_required:0},showOptions:!1,options:[]}},watch:(u={},d="fieldForm.type",f=function(e,t){var n=this;this.options.forEach(function(t){t.type==e&&(t.extra.options?n.showOptions=!0:n.showOptions=!1)})},d in u?Object.defineProperty(u,d,{value:f,enumerable:!0,configurable:!0,writable:!0}):u[d]=f,u),computed:s({},Object(i.b)(["currentModel"]),{channelFields:function(){return this.fields.filter(function(e){return 1===e.is_channel})},contentFields:function(){return this.fields.filter(function(e){return 0===e.is_channel})}}),methods:{saveOrderFactor:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return c(regeneratorRuntime.mark(function n(){var l,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(l=[],r=[],[],t?e.channelFields:e.contentFields,e.fields.forEach(function(e){l.push(e.id),r.push(e.order_factor)}),l.length){n.next=8;break}return e.$message({type:"warning",message:"无内容!"}),n.abrupt("return",!1);case 8:return n.next=10,a.a.saveModelFieldOrder({ids:l,orders:r});case 10:n.sent,e.$message({type:"success",message:"保存成功!"});case 12:case"end":return n.stop()}},n,e)}))()},handleEdit:function(e){this.fieldVisible=!0,Object.assign(this.fieldForm,e)},handleDelete:function(e){var t=this;this.$confirm("确定删除字段?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(c(regeneratorRuntime.mark(function n(){var l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return l=t.fieldForm.model_id,n.next=3,a.a.deleteModelField({model_id:l,id:e.id});case 3:return n.sent,n.next=6,t.loadModel(l);case 6:t.$message({type:"success",message:"删除成功!"});case 7:case"end":return n.stop()}},n,t)})))},add:function(e){"channel"==e?this.fieldForm.is_channel=1:"content"==e&&(this.fieldForm.is_channel=0),this.fieldVisible=!0,Object.assign(this.fieldForm,{id:"",type:"",field:"",label:"",extra:[{name:"",value:""}],is_custom:1,is_display:1,is_required:0}),this.showOptions=!1},loadFieldTypes:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.getModelFieldTypes();case 2:n=t.sent,e.options=n.data;case 4:case"end":return t.stop()}},t,e)}))()},loadModel:function(e){var t=this;return c(regeneratorRuntime.mark(function n(){var l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.a.getModel({id:e});case 2:l=n.sent,t.$store.dispatch(t.$types.CMS_CURRENT_MODEL,l.data),t.fields=l.data.fields,console.log("this.fields:",t.fields),t.fieldForm.model_id=l.data.id;case 7:case"end":return n.stop()}},n,t)}))()},doSaveField:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.modelSaveField(e.fieldForm);case 2:if(!t.sent.success){t.next=12;break}return e.fieldVisible=!1,n="添加成功!",e.fieldForm.id&&(n="更新成功!"),e.$message({message:n,type:"success"}),t.next=10,e.loadModel(e.model_id);case 10:t.next=13;break;case 12:e.$message({message:"出错了!请联系管理员",type:"warning"});case 13:case"end":return t.stop()}},t,e)}))()},handleClick:function(e,t){console.log(e,t)},handleOptionsChange:function(e){this.fieldForm.extra=e}},mounted:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var n,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=parseInt(e.$route.query.model_id||0),e.model_id=n,!e.model_id){t.next=5;break}return t.next=5,e.loadModel(e.model_id);case 5:return l=e.$route.query.type.toString(),e.type=l,t.next=9,e.loadFieldTypes();case 9:case"end":return t.stop()}},t,e)}))()}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-block"},[n("div",{staticClass:"l-block-header"},[n("div",[n("router-link",{attrs:{to:"/cms/setting/model",tag:"span"}},[n("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),e.currentModel?n("span",[n("span",{staticStyle:{"font-weight":"700"}},[e._v("“"+e._s(e.currentModel.name)+"”")]),e._v(e._s("content"==e.type?"内容":"栏目")+"字段管理")]):e._e()],1)]),e._v(" "),n("div",{staticClass:"l-block-body"},["channel"==e.type?n("div",{staticClass:"l-block"},[n("div",{staticClass:"l-block-header"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add(e.type)}}},[e._v("添加")])],1),e._v(" "),n("div",{staticClass:"l-block-body"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.channelFields}},[n("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),n("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),n("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),n("el-table-column",{attrs:{label:"排序值(升序)"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{staticClass:"l-w-60",model:{value:t.row.order_factor,callback:function(n){e.$set(t.row,"order_factor",n)},expression:"scope.row.order_factor"}})]}}],null,!1,1453190568)}),e._v(" "),n("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,103943926)})],1)],1),e._v(" "),n("div",{staticClass:"l-block-bottom"},[n("el-button",{on:{click:e.saveOrderFactor}},[e._v("保存排序")])],1)]):e._e(),e._v(" "),"content"==e.type?n("div",{staticClass:"l-block"},[n("div",{staticClass:"l-block-header"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add(e.type)}}},[e._v("添加")])],1),e._v(" "),n("div",{staticClass:"l-block-body"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.contentFields}},[n("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),n("el-table-column",{attrs:{prop:"field",label:"字段"}}),e._v(" "),n("el-table-column",{attrs:{prop:"label",label:"标签"}}),e._v(" "),n("el-table-column",{attrs:{label:"排序值(升序)"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{staticClass:"l-w-60",model:{value:t.row.order_factor,callback:function(n){e.$set(t.row,"order_factor",n)},expression:"scope.row.order_factor"}})]}}],null,!1,1453190568)}),e._v(" "),n("el-table-column",{attrs:{prop:"type",label:"字段类型"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,103943926)})],1)],1),e._v(" "),n("div",{staticClass:"l-block-bottom"},[n("el-button",{on:{click:e.saveOrderFactor}},[e._v("保存排序")])],1)]):e._e()]),e._v(" "),n("el-dialog",{attrs:{title:e.fieldTitle,visible:e.fieldVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.fieldVisible=t}}},[n("el-form",{attrs:{model:e.fieldForm,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"标签"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.label,callback:function(t){e.$set(e.fieldForm,"label",t)},expression:"fieldForm.label"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"字段"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.fieldForm.field,callback:function(t){e.$set(e.fieldForm,"field",t)},expression:"fieldForm.field"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"类型"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.fieldForm.type,callback:function(t){e.$set(e.fieldForm,"type",t)},expression:"fieldForm.type"}},e._l(e.options,function(e){return n("el-option",{key:e.value,attrs:{label:e.name,value:e.type}})}),1)],1),e._v(" "),e.showOptions?n("el-form-item",{attrs:{label:"选项"}},[n("add-options",{attrs:{options:e.fieldForm.extra},on:{optionsChange:e.handleOptionsChange}})],1):e._e()],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.fieldVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.doSaveField}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var v=n("VU/8")(p,m,!1,function(e){n("/ziT")},"data-v-75349ff1",null);t.default=v.exports}});
//# sourceMappingURL=2.53493cad7d5ac600fa6a.js.map