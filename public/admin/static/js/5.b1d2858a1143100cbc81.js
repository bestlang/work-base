webpackJsonp([5],{"8xki":function(e,t){},BgHB:function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a={name:"tag",props:{value:{type:Array,required:!1,default:function(){return[{id:0,name:""}]}}},data:function(){return{rowData:[]}},watch:{rowData:{deep:!0,handler:function(e){this.$emit("input",e)}}},methods:{addRow:function(e){this.rowData=[].concat(r(this.value));var t=0,n=!0,a=!1,o=void 0;try{for(var i,s=this.rowData[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;l.id>t&&(t=l.id)}}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}var c={id:t+1,name:""};this.rowData.push(c)},deleteRow:function(e){for(var t in this.rowData=[].concat(r(this.value)),this.rowData)if(this.rowData[t].id==e.id){this.$delete(this.rowData,t);break}}},mounted:function(){this.value.length>0&&(this.rowData=[].concat(r(this.value)))}},o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"add-row-tag"},e._l(this.value,function(t,r){return n("el-row",{key:r,staticClass:"row-item",attrs:{gutter:0}},[n("el-col",{attrs:{span:7}},[n("el-input",{staticClass:"row-ipt",attrs:{placeholder:"请输入标签"},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"row.name"}})],1),e._v(" "),n("el-col",{staticStyle:{"margin-top":"5px"},attrs:{span:3}},[n("i",r+1==1?{staticClass:"add-icon el-icon-circle-plus",on:{click:function(n){return e.addRow(t)}}}:{staticClass:"add-icon el-icon-remove",on:{click:function(n){return e.deleteRow(t)}}})])],1)}),1)},staticRenderFns:[]};var i=n("VU/8")(a,o,!1,function(e){n("PAj3")},"data-v-0749fa17",null);t.a=i.exports},PAj3:function(e,t){},uSH3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("w+Hh"),a=n("Pgpu"),o=n.n(a),i=n("trTH"),s=n("FO7G"),l=n("M+9c"),c=n("jk0Z"),u=n("BgHB"),f=n("NYxO"),d=n("gyMJ"),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function p(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var h={data:function(){return{checkList:[],showSwitch:!1,contents:[],formTitle:"编辑内容",form:{positions:[]},ueditorConfig:i.a,contentPositions:[],channel_id:0,content_id:0}},components:{"channel-tree":r.a,VueUeditorWrap:o.a,imageUpload:s.a,multipleImageUpload:l.a,attachment:c.a,tag:u.a},computed:m({},Object(f.b)(["parentChannel","currentChannel","currentModel"])),watch:{content_id:function(e){var t=this;return p(regeneratorRuntime.mark(function n(){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e){n.next=10;break}return n.next=3,t.loadWholeContent(e);case 3:return n.next=5,d.a.getCmsChannelWhole({id:t.channel_id});case 5:return r=n.sent,a=r.data,t.$store.commit(t.$types.CMS_CURRENT_CHANNEL,a),n.next=10,t.loadContentPositions(t.currentChannel.id);case 10:case"end":return n.stop()}},n,t)}))()}},methods:{goback:function(){this.$router.push("/cms/content?channel_id="+this.currentChannel.id)},loadWholeContent:function(e){var t=this;return p(regeneratorRuntime.mark(function n(){var r,a,o,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.getWholeContent({id:e});case 2:r=n.sent,a=r.data,t.channel_id=a.channel_id,(o=r.data.model).fields=o.fields.filter(function(e){return!e.is_channel}),i=["channel_id","model_id","title","keywords","description"],t.$set(t.form,"id",e),i.forEach(function(e){t.$set(t.form,e,a[e])}),a.contents&&a.contents.length&&a.contents.forEach(function(e){t.$set(t.form,e.field,e.value)}),a.metas&&a.metas.length&&a.metas.forEach(function(e){t.$set(t.form,e.field,e.value)}),a.positions&&t.$set(t.form,"positions",a.positions),a.tags.length?t.$set(t.form,"tags",a.tags):t.$set(t.form,"tags",[{id:1,name:""}]),t.$store.dispatch(t.$types.CMS_CURRENT_MODEL,o);case 15:case"end":return n.stop()}},n,t)}))()},saveContent:function(){var e=this;return p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.form.channel_id||e.form.model_id||(e.$set(e.form,"model_id",e.currentModel.id),e.$set(e.form,"channel_id",e.currentChannel.id)),t.next=3,d.a.saveContent(e.form);case 3:t.sent.success&&(e.$message({type:"success",message:"添加成功!"}),e.goback());case 5:case"end":return t.stop()}},t,e)}))()},handleNodeClick:function(e){var t=this;return p(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e[0],t.channel_id=r.id,t.$store.dispatch(t.$types.CMS_CURRENT_CHANNEL,r),t.$store.dispatch(t.$types.CMS_PARENT_CHANNEL,r),n.next=6,t.loadModel(r.model.id);case 6:return n.next=8,t.loadContentPositions();case 8:case"end":return n.stop()}},n,t)}))()},loadModel:function(e){var t=this;return p(regeneratorRuntime.mark(function n(){var r,a,o,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.getModel({id:e});case 2:for(o in r=n.sent,(a=r.data).fields=a.fields.filter(function(e){return!e.is_channel}),t.$store.dispatch(t.$types.CMS_CURRENT_MODEL,a),t.currentModel.fields)i=t.currentModel.fields[o],t.$set(t.form,i.field,""),"checkbox"!=i.type&&"multiple-image"!=i.type||t.$set(t.form,i.field,[]);t.$set(t.form,"positions",[]);case 8:case"end":return n.stop()}},n,t)}))()},loadContentPositions:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return p(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t||e.currentChannel&&e.currentChannel.id&&(t=e.currentChannel.id),t){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,d.a.getContentPositions({channel_id:t});case 5:r=n.sent,e.contentPositions=r.data;case 7:case"end":return n.stop()}},n,e)}))()}},mounted:function(){var e=this;return p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.content_id=parseInt(e.$route.query.content_id||0),e.$store.dispatch("toggleState");case 2:case"end":return t.stop()}},t,e)}))()}},v={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-content-list"},[n("div",{directives:[{name:"title",rawName:"v-title",value:"内容管理",expression:"'内容管理'"}]}),e._v(" "),n("div",{staticClass:"l-tree-content"},[e.currentModel?n("div",{staticClass:"l-block"},[n("div",{staticClass:"l-block-header"},[n("div",[n("span",{staticClass:"l-go-back",on:{click:e.goback}},[n("span",{staticClass:"iconfont"},[e._v("")]),e._v("返回")]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),e.currentChannel?n("span",[e._v("在"),n("span",{staticStyle:{"font-weight":"700"}},[e._v("“"+e._s(e.currentChannel.name)+"”")]),e._v("下"+e._s(e.formTitle))]):e._e()],1)]),e._v(" "),n("div",{staticClass:"l-block-body"},[n("el-form",{attrs:{"label-width":"100px"}},[e._l(e.currentModel.fields,function(t,r){return["text"==t.type?n("el-form-item",{attrs:{label:t.label}},[n("el-input",{key:r,attrs:{name:t.field},model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"number"==t.type?n("el-form-item",{attrs:{label:t.label}},[n("el-input",{key:r,staticClass:"price",attrs:{type:"number",name:t.field},model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"checkbox"==t.type&&Array.isArray(e.form[t.field])?n("el-form-item",{attrs:{label:t.label}},[n("el-checkbox-group",{model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}},e._l(t.extra,function(t){return n("el-checkbox",{attrs:{label:t.value}},[e._v(e._s(t.name))])}),1)],1):e._e(),e._v(" "),"image"==t.type?n("el-form-item",{attrs:{label:t.label}},[n("image-upload",{model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"multiple-image"==t.type&&e.form[t.field]?n("el-form-item",{attrs:{label:t.label}},[n("multiple-image-upload",{model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"attachment"==t.type&&e.form[t.field]?n("el-form-item",{staticClass:"l-mb-22",attrs:{label:t.label}},[n("div",[n("attachment",{model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1)]):e._e(),e._v(" "),"textarea"==t.type?n("el-form-item",{attrs:{label:t.label}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1):e._e(),e._v(" "),"content"==t.type?n("el-form-item",{staticClass:"l-mb-22",attrs:{label:t.label}},[n("div",[n("vue-ueditor-wrap",{attrs:{config:e.ueditorConfig},model:{value:e.form[t.field],callback:function(n){e.$set(e.form,t.field,n)},expression:"form[item.field]"}})],1)]):e._e()]}),e._v(" "),n("el-form-item",{attrs:{label:"标签"}},[n("tag",{model:{value:e.form.tags,callback:function(t){e.$set(e.form,"tags",t)},expression:"form.tags"}})],1),e._v(" "),e.contentPositions&&e.contentPositions.length?n("el-form-item",{attrs:{label:"编辑推荐位"}},[n("el-checkbox-group",{model:{value:e.form.positions,callback:function(t){e.$set(e.form,"positions",t)},expression:"form.positions"}},e._l(e.contentPositions,function(t){return n("el-checkbox",{attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1):e._e(),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveContent}},[e._v("提交")])],1)],2)],1)]):e._e()])])},staticRenderFns:[]};var _=n("VU/8")(h,v,!1,function(e){n("8xki")},"data-v-26901d55",null);t.default=_.exports}});
//# sourceMappingURL=5.b1d2858a1143100cbc81.js.map