webpackJsonp([6],{DBCZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("mvHQ"),a=n.n(r),s=n("bOdI"),i=n.n(s),o=n("Xxa5"),l=n.n(o),c=n("exGp"),d=n.n(c),u=n("gyMJ"),p=n("Dd8w"),f=n.n(p),v=n("NYxO"),m={data:function(){return{customProps:{children:"children",label:"name"},treeData:[]}},props:{title:{type:String,default:""},updated:{type:Number,default:0}},watch:{updated:function(){var e=this;return d()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateTree();case 2:case"end":return t.stop()}},t,e)}))()}},computed:f()({},Object(v.b)([])),methods:{handleNodeClick:function(e){this.$emit("nodeClick",e)},updateTree:function(){var e=this;return d()(l.a.mark(function t(){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.sniperDingGetDepartments();case 2:n=t.sent,e.treeData=[n.data],e.$emit("treeLoaded",e.treeData[0]);case 5:case"end":return t.stop()}},t,e)}))()}},mounted:function(){var e=this;return d()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateTree();case 2:case"end":return t.stop()}},t,e)}))()}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-tree-containner"},[e.title?n("view",[e._v(e._s(e.title))]):e._e(),e._v(" "),n("el-tree",{ref:"tree",attrs:{"icon-class":"el-icon-caret-right","default-expand-all":!0,data:e.treeData,"node-key":"id",props:e.customProps,"highlight-current":!0,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node"},[n("span",[a.children.length?e._e():n("span",{staticClass:"iconfont"},[e._v("")]),e._v(e._s(r.label))])])}}])})],1)},staticRenderFns:[]};var _={components:{DingDepartmentTree:n("VU/8")(m,h,!1,function(e){n("tegS")},null,null).exports},data:function(){return{updated:0,department:null,users:[]}},watch:i()({},"department.id",function(e){var t=this;return d()(l.a.mark(function n(){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getDepartmentUsers({id:e});case 2:case"end":return n.stop()}},n,t)}))()}),methods:{resultHtml:function(e){var t="";return e.Late&&(t+='<span style="color: red">迟到'+e.Late+"次</span>"),e.Early&&(t+='<span style="color: orange">早退'+e.Early+"次</span>"),e.NotSigned&&(t+='<span style="color: gray">未打卡'+e.NotSigned+"次</span>"),t||(t='<span style="color: green">正常</span>'),t},viewDetail:function(e){e.userid;this.$router.push("/sniper/employee/employee/attendance/detail?userId="+e.userid+"&month=2020-09")},handleNodeClick:function(e){this.department=e,console.log("node click:"+a()(e))},performTreeLoaded:function(e){console.log("performTreeLoaded:"+a()(e)),this.department=e},getDepartmentUsers:function(e){var t=this,n=e.id;return d()(l.a.mark(function e(){var r,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.sniperDingGetDepartmentUsers({id:n});case 2:return r=e.sent,a=r.data.map(function(e){return e.userid}),t.users=r.data,e.next=7,t.getUsersAttendance({userIds:a});case 7:case"end":return e.stop()}},e,t)}))()},getUsersAttendance:function(e){var t=this,n=e.userIds;return d()(l.a.mark(function e(){var r,s,i,o,c,d,p,f,v,m;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.sniperDingGetUsersAttendance({userIds:n});case 2:for(o in r=e.sent,s=r.data,i={},s)for(c in s[o])for(d in i[o]||(i[o]={}),s[o][c])i[o][s[o][c][d].timeResult]||(i[o][s[o][c][d].timeResult]=0),s[o][c][d].approveId||s[o][c][d].procInstId||(i[o][s[o][c][d].timeResult]+=1);for(p in i)for(f in console.log(p,"\n"),t.users)if(t.users[f].userid==p){for(m in t.$set(t.users[f],"result",i[p]),t.$set(t.users[f],"leave",s[p].leave),v="",s[p].leave)v+="["+s[p].leave[m].start_time+"~"+s[p].leave[m].end_time+"],";t.$set(t.users[f],"leaveStr",v.slice(0,-1))}console.log("lastArr:"+a()(i));case 8:case"end":return e.stop()}},e,t)}))()}}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-position-list"},[n("div",{directives:[{name:"title",rawName:"v-title",value:"考勤记录",expression:"'考勤记录'"}]}),e._v(" "),n("ding-department-tree",{attrs:{updated:e.updated},on:{nodeClick:e.handleNodeClick,treeLoaded:e.performTreeLoaded}}),e._v(" "),n("div",{staticClass:"l-block"},[n("div",{staticClass:"l-block-header"},[e._v("\n            "+e._s(e.department?e.department.name:"")+"\n        ")]),e._v(" "),n("div",{staticClass:"l-block-body"},[n("div",{staticClass:"l-user-wrap"},e._l(e.users,function(t,r){return n("div",{key:r,staticClass:"l-user",on:{click:function(n){return e.viewDetail(t)}}},[n("div",{staticStyle:{"border-bottom":"1px solid #f1f1f1","padding-bottom":"10px"}},[n("div",[n("b",[e._v(e._s(t.name))]),n("small",{staticStyle:{color:"#fff",display:"none"}},[e._v(e._s(t.userid))])]),e._v(" "),n("div",[n("small",{staticStyle:{color:"#afafaf"}},[e._v(e._s(t.orgEmail?t.orgEmail:"-"))])])]),e._v(" "),n("div",[t.result?n("div",[n("small",[e._v("本月：\n                                        "),n("span",{staticStyle:{"font-weight":"700"},domProps:{innerHTML:e._s(e.resultHtml(t.result))}}),e._v(" "),t.leave&&t.leave.length?n("span",{attrs:{title:t.leaveStr}},[n("small",{staticStyle:{color:"darkorange","font-weight":"normal"}},[n("span",{staticClass:"iconfont"},[e._v("")]),e._v("请假"+e._s(t.leave.length)+"次")])]):e._e()])]):e._e()]),e._v(" "),n("div")])}),0)])])],1)},staticRenderFns:[]};var k=n("VU/8")(_,g,!1,function(e){n("SXOd")},"data-v-dd261dd4",null);t.default=k.exports},SXOd:function(e,t){},tegS:function(e,t){}});
//# sourceMappingURL=6.7f4f731760eb5b840932.js.map