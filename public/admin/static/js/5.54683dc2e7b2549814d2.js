webpackJsonp([5],{J4LN:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=t("bOdI"),l=t.n(a),s=t("woOf"),i=t.n(s),o=t("trTH"),r=t("Pgpu"),c={data:function(){return{checkList:[],channelPositions:[],customProps:{children:"children",label:"name"},title:"添加子栏目",showChannelChildren:!0,channelForm:{id:null,model_id:"",parent_id:null,name:null,positions:[]},customChannelFields:[]}},components:{VueUeditorWrap:t.n(r).a},computed:{loading:function(){return this.$store.getters.loading},treeData:function(){return this.$store.getters.channels},children:function(){return this.$store.getters.channelChildren},models:function(){return this.$store.getters.models},parentChannel:function(){return this.$store.getters.parentChannel},ueditorConfig:function(){return o.a}},methods:{addChannel:function(e){this.showChannelChildren=!1,this.channelForm=i()({},{id:null,parent_id:e.id,model_id:"",channel_id:null,name:null,positions:[]}),this.$store.dispatch(this.$types.CMS_PARENT_CHANNEL,e),this.customChannelFields=[]},editChannel:function(e){this.loadWholeChannel(e),this.showChannelChildren=!1,this.$store.dispatch(this.$types.CMS_CURRENT_CHANNEL,e)},deleteChannel:function(e){var n=this;this.$confirm("确定删除本栏目?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n.$http.post("/admin/cms/channel/delete",{id:e.id}).then(function(t){t.success?(n.$store.dispatch(n.$types.CMS_CHANNELS,{id:e.parent_id}),n.showChannelChildren=!0,n.$message({type:"success",message:"删除成功!"})):n.$message({type:"error",message:t.error})}).catch(function(){})}).catch(function(){})},handleNodeClick:function(e){e.children.length>0?(this.$store.dispatch(this.$types.CMS_CHANNEL_CHILDREN,e),this.showChannelChildren=!0,this.$store.dispatch(this.$types.CMS_PARENT_CHANNEL,e)):(this.showChannelChildren=!1,this.loadWholeChannel(e))},doSubmit:function(){this.channelForm.id?this.doEdit():this.doAdd()},doCancel:function(){this.showChannelChildren=!0},doAdd:function(){var e=this;this.showChannelChildren=!1,this.$http.post("/admin/cms/channel/save",this.channelForm).then(function(n){n.success?(e.showChannelChildren=!0,e.$store.dispatch(e.$types.CMS_CHANNELS,e.parentChannel),e.$message({type:"success",message:"添加成功!"})):e.$message({type:"error",message:"添加失败!"+n.error})})},doEdit:function(){var e=this;this.$http.post("/admin/cms/channel/save",this.channelForm).then(function(n){n.success?(e.$message({type:"success",message:"修改成功!"}),e.$store.dispatch(e.$types.CMS_CHANNELS,{id:e.channelForm.parent_id})):e.$message({type:"warning",message:"修改失败!"+n.error})})},loadWholeChannel:function(e){var n=this,t=e.id;this.$http.get("/admin/cms/channel/whole",{params:{id:t}}).then(function(e){var t=e.data;n.channelForm={};["id","model_id","parent_id","name","title","keywords","description"].forEach(function(e){n.$set(n.channelForm,e,t[e])}),t.contents&&t.contents.length&&t.contents.forEach(function(e){n.$set(n.channelForm,e.field,e.value)}),t.metas&&t.metas.length&&t.metas.forEach(function(e){n.$set(n.channelForm,e.field,e.value)}),t.positions&&n.$set(n.channelForm,"positions",t.positions)})},loadChannelPositions:function(){var e=this;this.$http.get("/admin/cms/positions",{params:{is_channel:1}}).then(function(n){e.channelPositions=n.data})}},mounted:function(){this.$store.dispatch("toggleState"),this.$store.dispatch(this.$types.CMS_CHANNELS),this.$store.dispatch(this.$types.CMS_MODELS),this.loadChannelPositions()},watch:l()({},"channelForm.model_id",function(e,n){var t=this;e?this.models.length>0&&this.models.forEach(function(e){e.id==t.channelForm.model_id&&(t.customChannelFields=e.fields.filter(function(e){return e.is_channel&&(t.channelForm.hasOwnProperty(e.field)||(t.$set(t.channelForm,e.field,""),"checkbox"==e.type&&t.$set(t.channelForm,e.field,[]))),e.is_channel}))}):this.customChannelFields=[]})},h={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"l-channel-list"},[t("div",{staticClass:"l-tree-containner"},[t("el-tree",{ref:"tree",attrs:{"icon-class":"el-icon-caret-right","default-expand-all":!0,data:e.treeData,"node-key":"id",props:e.customProps,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.node,l=n.data;return t("span",{staticClass:"custom-tree-node"},[t("span",[l.children.length?e._e():t("span",{staticClass:"iconfont"},[e._v("")]),e._v(e._s(a.label))])])}}])})],1),e._v(" "),e.showChannelChildren?t("div",{staticClass:"l-tree-content"},[t("div",{staticClass:"l-block"},[e.parentChannel&&e.parentChannel.id?t("div",{staticClass:"l-block-header"},[t("span",[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(e.parentChannel.hasOwnProperty("name")?e.parentChannel.name:""))]),e._v(" "),t("el-button-group",[t("el-button",{staticStyle:{padding:"3px 10px"},attrs:{type:"text"},on:{click:function(n){return e.editChannel(e.parentChannel)}}},[e._v("编辑")]),e._v(" "),t("el-button",{staticStyle:{padding:"3px 10px"},attrs:{type:"text"},on:{click:function(n){return e.addChannel(e.parentChannel)}}},[e._v("新增子栏目")])],1)],1):t("div",{staticClass:"l-block-header"},[t("el-button",{staticStyle:{padding:"3px 10px"},attrs:{type:"text"},on:{click:function(n){return e.addChannel({id:0})}}},[e._v("新增栏目")])],1),e._v(" "),t("div",{staticClass:"l-block-body"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.children}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e._v(" "),t("el-table-column",{attrs:{prop:"name",label:"栏目名"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editChannel(n.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addChannel(n.row)}}},[e._v("新增子栏目")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteChannel(n.row)}}},[e._v("删除")])]}}],null,!1,3640908394)})],1)],1)])]):e._e(),e._v(" "),e.showChannelChildren?e._e():t("div",{staticClass:"l-tree-content"},[e.showChannelChildren?e._e():t("div",{staticClass:"l-block"},[e.parentChannel&&e.parentChannel.id?t("div",{staticClass:"l-block-header"},[t("span",[e.channelForm.id?t("span",[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(e.channelForm.name))]):t("span",[e._v("\n                在「"),t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(e.parentChannel.name)+"」下新增栏目\n              ")])]),e._v(" "),t("el-button-group",[t("el-button",{staticStyle:{padding:"3px 10px"},attrs:{type:"text"},on:{click:function(n){return e.addChannel(e.channelForm)}}},[e._v("新增子栏目")]),e._v(" "),t("el-button",{staticStyle:{padding:"3px 10px"},attrs:{type:"text"},on:{click:function(n){return e.deleteChannel(e.channelForm)}}},[e._v("删除")])],1)],1):e._e(),e._v(" "),t("div",{staticClass:"l-block-body"},[t("el-form",{attrs:{model:e.channelForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"模型"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.channelForm.model_id,callback:function(n){e.$set(e.channelForm,"model_id",n)},expression:"channelForm.model_id"}},e._l(e.models,function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"栏目名"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.channelForm.name,callback:function(n){e.$set(e.channelForm,"name",n)},expression:"channelForm.name"}})],1),e._v(" "),e._l(e.customChannelFields,function(n,a){return["text"==n.type?t("el-form-item",{attrs:{label:n.label}},[t("el-input",{key:a,attrs:{name:n.field},model:{value:e.channelForm[n.field],callback:function(t){e.$set(e.channelForm,n.field,t)},expression:"channelForm[item.field]"}})],1):e._e(),e._v(" "),"checkbox"==n.type&&Array.isArray(e.channelForm[n.field])?t("el-form-item",{attrs:{label:n.label}},[t("el-checkbox-group",{model:{value:e.channelForm[n.field],callback:function(t){e.$set(e.channelForm,n.field,t)},expression:"channelForm[item.field]"}},e._l(n.extra,function(n){return t("el-checkbox",{attrs:{label:n.value}},[e._v(e._s(n.name))])}),1)],1):e._e(),e._v(" "),"textarea"==n.type?t("el-form-item",{attrs:{label:n.label}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.channelForm[n.field],callback:function(t){e.$set(e.channelForm,n.field,t)},expression:"channelForm[item.field]"}})],1):e._e(),e._v(" "),"content"==n.type?t("el-form-item",{staticClass:"l-mb-22",attrs:{label:n.label}},[t("div",[t("vue-ueditor-wrap",{attrs:{config:e.ueditorConfig},model:{value:e.channelForm[n.field],callback:function(t){e.$set(e.channelForm,n.field,t)},expression:"channelForm[item.field]"}})],1)]):e._e()]}),e._v(" "),e.channelPositions.length?t("el-form-item",{attrs:{label:"栏目推荐位"}},[t("el-checkbox-group",{model:{value:e.channelForm.positions,callback:function(n){e.$set(e.channelForm,"positions",n)},expression:"channelForm['positions']"}},e._l(e.channelPositions,function(n){return t("el-checkbox",{attrs:{label:n.id}},[e._v(e._s(n.name))])}),1)],1):e._e(),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.doSubmit}},[e._v("确定")])],1)],2)],1)])])])},staticRenderFns:[]};var d=t("VU/8")(c,h,!1,function(e){t("JJxi")},"data-v-a49a863e",null);n.default=d.exports},JJxi:function(e,n){}});
//# sourceMappingURL=5.54683dc2e7b2549814d2.js.map